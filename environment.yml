# Production Environment Configuration for Drug Discovery Assistant
# Optimized for NVIDIA GTX 1650 (4GB VRAM) and similar hardware

name: drug-discovery
channels:
  - conda-forge
  - pytorch
  - nvidia
  - defaults

dependencies:
  # Python environment
  - python=3.9.6
  - pip=23.3

  # Core scientific computing
  - numpy=1.24
  - scipy=1.10
  - pandas=2.0
  - scikit-learn=1.3

  # PyTorch ecosystem (CUDA 11.8 compatible)
  - pytorch=2.0.1
  - torchvision=0.15.2
  - torchaudio=2.0.2
  - pytorch-cuda=11.8

  # Chemistry and molecular informatics
  - rdkit=2023.03.3
  - openmm=7.7
  - mdtraj=1.9

  # Machine learning frameworks
  - xgboost=1.7.6
  - lightgbm=4.0.0
  - optuna=3.4.0

  # Visualization and plotting
  - matplotlib=3.7
  - seaborn=0.12
  - plotly=5.17
  - bokeh=3.2

  # Web framework and UI
  - streamlit=1.28.1
  - streamlit-aggrid=0.3.4

  # Development and testing
  - pytest=7.4
  - pytest-cov=4.1
  - black=23.9
  - ruff=0.1.3
  - mypy=1.6

  # Jupyter ecosystem
  - jupyter=1.0
  - ipywidgets=8.1
  - notebook=7.0

  # System utilities
  - tqdm=4.66
  - click=8.1
  - pyyaml=6.0
  - python-dotenv=1.0
  - requests=2.31
  - urllib3=2.0

  # Memory profiling and optimization
  - psutil=5.9
  - py-cpuinfo=9.0
  - gpustat=1.1

  # Additional pip dependencies not available via conda
  - pip:
      # DeepChem (chemistry-focused deep learning)
      - deepchem==2.7.1
      - tensorflow==2.13.0  # DeepChem compatible version
      - keras==2.13.1

      # SELFIES molecular representation
      - selfies==2.1.1
      
      # Transformers and NLP
      - transformers==4.35.0
      - tokenizers==0.14.1
      - datasets==2.14.6
      
      # 3D molecular visualization
      - py3dmol==2.0.4
      - stmol==0.0.9
      
      # Protein structure analysis
      - biotite==0.37.0
      - biopython==1.81
      
      # Additional molecular descriptors
      - mordred==1.2.0
      - descriptastorus==2.6.0
      
      # Advanced optimization
      - bayesian-optimization==1.4.3
      - hyperopt==0.2.7
      
      # Memory optimization
      - memory-profiler==0.61.0
      - pympler==0.9
      
      # Enhanced data formats
      - h5py==3.9.0
      - zarr==2.16.1
      
      # Additional utilities
      - python-dateutil==2.8.2
      - joblib==1.3.2
      - cloudpickle==3.0.0
      
      # API and web utilities
      # - fastapi==0.104.1
      # - uvicorn==0.24.0
      - httpx==0.25.0
      
      # Enhanced plotting
      - kaleido==0.2.1  # For plotly static image export
      
      # Development tools
      - pre-commit==3.5.0
      - bandit==1.7.5
      - safety==2.3.5
      - streamlit-option-menu==0.3.6

# Environment variables to set after activation
variables:
  # CUDA memory management for GTX 1650
  PYTORCH_CUDA_ALLOC_CONF: "max_split_size_mb:512,garbage_collection_threshold:0.6,expandable_segments:True"
  
  # Prevent CUDA device assertion errors
  CUDA_LAUNCH_BLOCKING: "1"
  
  # OpenMP settings for CPU fallback
  OMP_NUM_THREADS: "4"
  MKL_NUM_THREADS: "4"
  
  # TensorFlow GPU memory growth
  TF_FORCE_GPU_ALLOW_GROWTH: "true"
  TF_GPU_ALLOCATOR: "cuda_malloc_async"
  
  # RDKit settings
  RDKIT_NUM_THREADS: "4"
  
  # Model cache directories
  MODEL_CACHE_DIR: "./data/models"
  DATA_CACHE_DIR: "./data/processed"
  TRANSFORMERS_CACHE: "./data/models/transformers"
  
  # Streamlit configuration
  STREAMLIT_SERVER_HEADLESS: "true"
  STREAMLIT_SERVER_PORT: "8501"
  
  # DeepChem settings
  DEEPCHEM_DATA_DIR: "./data/deepchem"
  
  # Logging
  PYTHONUNBUFFERED: "1"
  LOG_LEVEL: "INFO"

# Post-create hooks (for conda-pack compatibility)
post:
  - conda clean --all --yes
  - pip cache purge